# WP-API - Laravel API for WordPress

WP-API is a WordPress plugin that provides a fast API for reading data from your WordPress website via Laravel. Since Laravel is highly configurable and can be configured to only load the necessary requirements to build an API interface, it can be used to provide much faster endpoints for your WordPress website.

At the moment, WP-API only provides a search endpoint, which can be used to quickly query your posts, pages, attachments and custom post types.

# Installation

To install WP-API, download a copy of the plugin and upload it via the plugin installation page of your WordPress dashboard. Do not activate the plugin yet, as you need to setup Laravel first. If you're not familiar with Laravel, you can follow the steps below to setup your installation.

## 1) Configurations

By default, WP-API will try to read the configurations by parsing the `wp-config` file. This is achieved via regex and without actually loading the file, thus not loading the WordPress core. Although you can set your config via `.env` file that is used by Laravel, it is highly recommended that you use `wp-config.php` for this purpose, to minimize the risk of data exposure.

The following constants will be read from `wp-config.php` to configure the database connection:

- DB_NAME
- DB_USER
- DB_PASSWORD
- DB_HOST
- DB_PORT

Simply leaving these as they are is enough to configure the connection to the database.

To configure the Laravel specific variables, prefix define a constant and prefix it with `WP_API_`. For instance, to provide the `APP_DEBUG` environmental variable, define a constant as:

    define( 'WP_API_APP_DEBUG', TRUE );

The following variables are supported by WP-API:

- APP_KEY
- APP_DEBUG
- APP_URL
- MEMCACHED_HOST
- REDIS_HOST
- REDIS_PASSWORD
- REDIS_PORT
- DB_PREFIX

Next, define a constant named `WP_API_OVERRIDE_CONFIG` in your `wp-config.php` and set its value to true, to inform WP-API that it should ignore the `.env` file and use `wp-config.php` instead:

	define( 'WP_API_OVERRIDE_CONFIG', TRUE );

## 2) Installing dependencies

This repository does not include the vendor files. To install the dependencies, navigate to the `api` subdirectory inside the plugin, and run the following command:

	composer install

This will install the requirements ( including Laravel framework ) and generate a new autoloader.

To generate a new application key, enter the command below:

	php artisan key:generate

This will add a new variable named `APP_KEY` in your `.env` file. You should probably prefix it with `WP_API_` and set it in your `wp-config.php`, and then delete the contents of the `.env` file.

## 3) Optional Caching

Since Laravel provides caching system for routes, configurations, views, etc., you can run the following commands to speed up the loading times of the API even more. These have no impact on the caching of data itself.

	php artisan config:cache
	php artisan route:cache

The generated cache files will be stored inside the `api/bootstrap/cache` subdirectory.

# Usage


After you have installed the plugin by following the steps above, activate the plugin. Activating the plugin will set the default settings, which disables the API completely. To enable the API, head over to `WP-API` menu, and enable the features that you need.

## - Using Search API

Currently, this is the only feature provided by this package. The way it works is that it generates keywords based on your post's title, and stores them in an indexed column in your database. You can then query a list of posts that have these keywords via the API.  Note that you can also add your own keywords to the list of keywords generated by default, which can also be Enabled/Disabled.

The search API provided 4 endpoints:

- api/public/search/posts/{keywords}
- api/public/search/pages/{keywords}
- api/public/search/attachments/{keywords}
- api/public/search/cpt/{post-type}/{keywords}

These can be used to query posts, pages, attachments and custom post types respectively. For example, to query a page that has the `hello` and `world` keywords, simply send a get request as follows:

	api/public/search/pages/hello world

Everything that comes after the `/pages/` path will be sliced into an array of keywords separated by a space. This means that you can send the user's search directly to the endpoint and it will generate the required keywords. You can also send a single keyword.

To query a custom post type, enable the option via the WordPress's admin area first. Then, send a request containing your query and the post type. For example, this will query the custom post type named `example` and search for the posts having the keywords `some`, `post` and `title`:

	api/public/search/cpt/example/some post title

The URL will be automatically decoded, so this is valid too:

	api/public/search/cpt/example/some%20post%20title

**Generating API endpoints**

To generate these URLs dynamically, WP-API provided a static helper method. You can use this method as below:

	WP_API\Kernel::getEndpointUrl( 'name' );

Which the `name` argument is the name of the endpoint. The current supported names are:

- search-posts
- search-pages
- search-attachments
- search-cpt

# Optimisation

WP-API offers caching the results of the queries. These results will be stored forever, until a post is modified or a new post is published. This will greatly reduce the response time, and completely eliminate the need for a database connection if the query is cached.

As mentioned, the cache results are automatically purged. To do this securely, a token will be generated on plugin activation and will be passed to the API when a request is made. You don't need to do anything about this, but if for any reason you need to regenerate this token, you can do so via the plugin's setting page.

# Rate limit

WP-API offers limiting the rate of requests based on the user's IP address. The default rate is limited to 60 requests per minute from the same IP address. You can change this via the plugin's settings.
